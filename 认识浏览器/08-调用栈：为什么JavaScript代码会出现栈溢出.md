> 在上一小节，我们知道了，当一段代码被执行时，JavaScript引擎会对其进行编译，并创建执行上下文。但是并没有明确说明到底什么样的代码才算符合规范。

## 哪些情况下代码才算是“一段代码”，才会在执行之前就进行编译并创建执行上下文？

1. 当JavaScript执行全局代码的时候，会编译全局代码并创建全局执行上下文，而且在整个页面的生存周期中，全局1执行上下文只有一份。
2. 当调用一个函数的时候，函数体内的代码会被编译，并创建函数执行上下文，一般情况下，当函数执行结束之后，创建的函数执行上下文会被销毁。
3. 当使用eval函数的时候，eval的代码也会被编译，并创建执行上下文。

## 学习调用栈的好处
1. 可以帮助你了解JavaScript引擎背后的工作原理
2. 让你有调试JavaScript代码的能力
3. 帮助你搞定面试，因为面试过程中，调用栈也是出境率非常高的题目。

> 比如你在写JavaScript代码的时候，有时候可能会遇到栈溢出的错误，为什么会出现这种错误呢？这就涉及到了调用栈的内容

**调用栈就是用来管理函数调用关系的一种数据结构**。

```js
var a = 2
function add(){
var b = 10
return  a+b
}
add()
```
1. 在执行到函数add()之前，JavaScript引擎会为上面这段代码创建全局执行上下文，包含了声明的函数和变量。
2. 从全局执行上下文中，取出add函数代码
3. 其次，对add函数的这段代码进行编译，并创建该函数的执行上下文和可执行代码
4. 最后，执行代码，输出结果

![image](https://user-images.githubusercontent.com/72426886/132269395-04ef0fe7-d776-469c-bf79-3edd5147fcc1.png)

## 什么是JavaScript的调用栈？
> JavaScript引擎正是利用栈的这种结构来管理执行上下文的。在执行上下文创建好后，JavaScript引擎会将执行上下文压入栈中，这种用来管理执行上下文的栈称为执行上下文栈，又称调用栈。

看下面这段代码：
```js
var a = 2
function add(b,c){
  return b+c
}
function addAll(b,c){
var d = 10
result = add(b,c)
return  a+result+d
}
addAll(3,6)
```
1. **创建全局上下文，并将其压入栈底**。如下图所示：


从图中你也可以看出，变量a、函数add和addAll都保存到了全局上下文的变量环境对象中。

全局执行上下文压入到调用栈后，JavaScript引擎便开始执行全局代码了。首先会执行a=2的赋值操作，执行该语句会将全局上下文变量环境中a的值设置为2。设置后的全局上下文的状态如下图所示：


2. **调用addAll函数**。

当调用该函数时，JavaScript引擎会编译该函数，并为其创建一个执行上下文，最后还将该函数的执行上下文压入栈中，如下图所示：


addAll函数的执行上下文创建好之后，便进入了函数代码的执行阶段了，先执行的是d=10的赋值操作，执行语句会将addAll函数执行上下文中的d由undefined变成10。

3. 当执行到add函数调用语句时，同样会为其创建执行上下文，并将其压入到调用栈中，如下图所示：



